/**
 * Vanilla Javascript Sticky Table v1.0.0
 * https://zhitkovkostya.github.io/sticky-table
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).StickyTable=t()}(this,function(){"use strict";return class{constructor(e){this.el=e,this.wrapperElement=null,this.headWrapperElement=null,this.bodyWrapperElement=null,this.headTableElement=null,this.bodyTableElement=null,this.scrollLeft=0,this._handleWindowScrollThrottled=this._throttle(this._handleWindowScroll.bind(this),20),this._handleWindowResizeThrottled=this._throttle(this._handleWindowResize.bind(this),20),this._handleHeadWrapperHorizontalScrollThrottled=this._throttle(this._handleHorizontalScroll.bind(this),10),this._handleBodyWrapperHorizontalScrollThrottled=this._throttle(this._handleHorizontalScroll.bind(this),10),this._wrapTable(),this._wrapTableHead(),this._wrapTableBody(),this._syncColumnWidth(),this._syncHeadPosition(),window.addEventListener("scroll",this._handleWindowScrollThrottled,!1),window.addEventListener("resize",this._handleWindowResizeThrottled)}_wrapTable(){const e=document.createElement("div");e.className="js-table-wrapper",this.el.parentNode&&this.el.parentNode.insertBefore(e,this.el),e.append(this.el),this.wrapperElement=e}_wrapTableHead(){const e=this.el.tHead;if(!e)throw new Error("<thead> is missing");var t=e.cloneNode(!0);this._toggleHeadVisibility(!1),this.headWrapperElement=document.createElement("div"),this.headTableElement=document.createElement("table"),this.headWrapperElement.className="js-table-head-wrapper",this.headWrapperElement.dataset.isFixed="false",this.headWrapperElement.style.overflowX="auto",this.headWrapperElement.ariaHidden="true",this.headWrapperElement.appendChild(this.headTableElement).appendChild(t),null!==(t=this.wrapperElement)&&void 0!==t&&t.insertBefore(this.headWrapperElement,this.el),this.headWrapperElement.addEventListener("scroll",this._handleHeadWrapperHorizontalScrollThrottled,!1)}_wrapTableBody(){var e;this.bodyWrapperElement=document.createElement("div"),this.bodyWrapperElement.className="js-table-body-wrapper",this.bodyWrapperElement.style.overflowX="auto",null!==(e=this.wrapperElement)&&void 0!==e&&e.insertBefore(this.bodyWrapperElement,this.el),this.bodyWrapperElement.appendChild(this.el),this.bodyWrapperElement.addEventListener("scroll",this._handleBodyWrapperHorizontalScrollThrottled,!1)}_syncColumnWidth(){var e,t=this.headTableElement,l=this.el;let i;if(t&&l&&l.tHead&&t.tHead)for(const r of l.tHead.rows)for(const s of r.cells)e=s.offsetWidth,i=t.tHead.rows[r.rowIndex].cells[s.cellIndex],i.style.minWidth=e+"px",i.style.maxWidth=e+"px"}_syncHeadPosition(){if(this.headWrapperElement&&this.bodyWrapperElement){let e="true"===this.headWrapperElement.dataset.isFixed;var{width:t,height:l}=this.headWrapperElement.getBoundingClientRect(),{top:i,width:r,height:s}=this.bodyWrapperElement.getBoundingClientRect(),n=2*l,a=(e?0:l)<=i,o=s+i-l<=0;e&&(a||o)?(this.headWrapperElement.style.position="",this.headWrapperElement.style.top="",this.headWrapperElement.style.zIndex="",this.headWrapperElement.style.width="",this.bodyWrapperElement.style.paddingTop="",this.headWrapperElement.dataset.isFixed="false",e=!1):e||a||o||(this.headWrapperElement.style.position="fixed",this.headWrapperElement.style.top="0",this.headWrapperElement.style.zIndex="2",this.headWrapperElement.style.width=r+"px",this.bodyWrapperElement.style.paddingTop=l+"px",this.headWrapperElement.dataset.isFixed="true",e=!0),e&&s+i<n?this.headWrapperElement.style.transform="translate3d(0, "+(s+i-n)+"px, 0)":this.headWrapperElement.style.transform="",t!==r&&(this.headWrapperElement.style.width=r+"px")}}_syncHorizontalScroll(e,t){e=e.scrollLeft;this.scrollLeft!==e&&(this.scrollLeft=e,t.scrollLeft=e)}_toggleHeadVisibility(t=!1){const e=this.el.tHead;if(!e)throw new Error("<thead> is missing");const l=Array.from(e.rows);var i=l.map(e=>Array.from(e.cells));const r=[].concat(...i);e.style.visibility=t?"":"collapse",r.forEach(e=>{e.style.height=t?"":"0",e.style.paddingTop=t?"":"0",e.style.paddingBottom=t?"":"0",e.style.lineHeight=t?"":"0"})}_handleHorizontalScroll(e){var t=e.target,e=t.nextSibling||t.previousSibling;this._syncHorizontalScroll(t,e)}_handleWindowScroll(){this._syncHeadPosition()}_handleWindowResize(){this._syncHeadPosition()}_throttle(t,l=100){let i=null;return(...e)=>{null===i&&(i=setTimeout(()=>{t.apply(this,e),i=null},l))}}destroy(){var e,t,l;for(window.removeEventListener("scroll",this._handleWindowScrollThrottled,!1),window.removeEventListener("resize",this._handleWindowResizeThrottled),null!==(l=this.headWrapperElement)&&void 0!==l&&l.removeEventListener("scroll",this._handleHeadWrapperHorizontalScrollThrottled,!1),null!==(l=this.bodyWrapperElement)&&void 0!==l&&l.removeEventListener("scroll",this._handleBodyWrapperHorizontalScrollThrottled,!1);null!==(e=this.bodyWrapperElement)&&void 0!==e&&e.firstChild;)null!==(e=this.wrapperElement)&&void 0!==e&&e.insertBefore(null===(e=this.bodyWrapperElement)||void 0===e?void 0:e.firstChild,this.bodyWrapperElement);for(;null!==(t=this.wrapperElement)&&void 0!==t&&t.firstChild;)null!==(t=this.wrapperElement.parentElement)&&void 0!==t&&t.insertBefore(null===(t=this.wrapperElement)||void 0===t?void 0:t.firstChild,this.wrapperElement);this._toggleHeadVisibility(!0),null!==(l=this.headWrapperElement)&&void 0!==l&&l.remove(),null!==(l=this.bodyWrapperElement)&&void 0!==l&&l.remove(),null!==(l=this.wrapperElement)&&void 0!==l&&l.remove(),this.el=null,this.headWrapperElement=null,this.headTableElement=null,this.bodyWrapperElement=null,this.wrapperElement=null}}});
