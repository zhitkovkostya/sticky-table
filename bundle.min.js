/**
 * Vanilla Javascript Sticky Table v1.0.0
 * https://zhitkovkostya.github.io/sticky-table
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).StickyTable=t()}(this,function(){"use strict";return class{constructor(e){this.el=e,this.wrapperElement=null,this.headWrapperElement=null,this.bodyWrapperElement=null,this.scrollLeft=0,this._wrapTable(),this._wrapTableHead(),this._wrapTableBody(),this._syncColumnWidth(),this._syncHeadPosition(),this._handleWindowScrollThrottled=this._throttle(this._handleWindowScroll.bind(this),20),this._handleWindowResizeThrottled=this._throttle(this._handleWindowResize.bind(this),20),this._handleHeadWrapperHorizontalScrollThrottled=null,this._handleBodyWrapperHorizontalScrollThrottled=null,window.addEventListener("scroll",this._handleWindowScrollThrottled.bind(this),!1),window.addEventListener("resize",this._handleWindowResizeThrottled.bind(this))}_wrapTable(){const e=document.createElement("div");e.className="js-table-wrapper",this.el.parentNode.insertBefore(e,this.el),e.append(this.el),this.wrapperElement=e}_wrapTableHead(){const e=document.createElement("table"),t=this.el.tHead;if(!t)throw new Error("<thead> is missing");const l=Array.from(t.rows);var r=l.map(e=>Array.from(e.cells));const i=[].concat(...r);r=t.cloneNode(!0);t.style.visibility="collapse",i.forEach(e=>{e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.lineHeight="0"}),e.classList.add("table"),this.headWrapperElement=document.createElement("div"),this.headWrapperElement.className="js-table-head-wrapper",this.headWrapperElement.dataset.isFixed="false",this.headWrapperElement.style.overflowX="auto",this.headWrapperElement.ariaHidden="true",this.headWrapperElement.appendChild(e).appendChild(r),this.wrapperElement&&this.wrapperElement.insertBefore(this.headWrapperElement,this.el),this._handleHeadWrapperHorizontalScrollThrottled=this._throttle(this._handleHorizontalScroll.bind(this),10),this.headWrapperElement.addEventListener("scroll",this._handleHeadWrapperHorizontalScrollThrottled.bind(this),!1)}_wrapTableBody(){this.bodyWrapperElement=document.createElement("div"),this.bodyWrapperElement.className="js-table-body-wrapper",this.bodyWrapperElement.style.overflowX="auto",this.wrapperElement&&this.wrapperElement.insertBefore(this.bodyWrapperElement,this.el),this.bodyWrapperElement.appendChild(this.el),this._handleBodyWrapperHorizontalScrollThrottled=this._throttle(this._handleHorizontalScroll.bind(this),10),this.bodyWrapperElement.addEventListener("scroll",this._handleBodyWrapperHorizontalScrollThrottled.bind(this),!1)}_syncColumnWidth(){var e,t=this.headWrapperElement.querySelector("table"),l=this.bodyWrapperElement.querySelector("table");let r;if(t&&l&&l.tHead&&t.tHead)for(var i of l.tHead.rows)for(var a of i.cells)e=a.offsetWidth,r=t.tHead.rows[i.rowIndex].cells[a.cellIndex],r.style.minWidth=e+"px",r.style.maxWidth=e+"px"}_syncHeadPosition(){if(this.headWrapperElement&&this.bodyWrapperElement){let e="true"===this.headWrapperElement.dataset.isFixed;var{width:t,height:l}=this.headWrapperElement.getBoundingClientRect(),{top:r,width:i,height:a}=this.bodyWrapperElement.getBoundingClientRect(),s=2*l,n=(e?0:l)<=r,o=a+r-l<=0;e&&(n||o)?(this.headWrapperElement.style.position="",this.headWrapperElement.style.top="",this.headWrapperElement.style.zIndex="",this.headWrapperElement.style.width="",this.bodyWrapperElement.style.paddingTop="",this.headWrapperElement.dataset.isFixed="false",e=!1):e||n||o||(this.headWrapperElement.style.position="fixed",this.headWrapperElement.style.top="0",this.headWrapperElement.style.zIndex="2",this.headWrapperElement.style.width=i+"px",this.bodyWrapperElement.style.paddingTop=l+"px",this.headWrapperElement.dataset.isFixed="true",e=!0),e&&a+r<s?this.headWrapperElement.style.transform="translate3d(0, "+(a+r-s)+"px, 0)":this.headWrapperElement.style.transform="",t!==i&&(this.headWrapperElement.style.width=i+"px")}}_syncHorizontalScroll(e,t){e=e.scrollLeft;this.scrollLeft!==e&&(this.scrollLeft=e,t.scrollLeft=e)}_handleHorizontalScroll(e){var t=e.target,e=t.nextSibling||t.previousSibling;t&&this._syncHorizontalScroll(t,e)}_handleWindowScroll(){this._syncHeadPosition()}_handleWindowResize(){this._syncHeadPosition()}_throttle(t,l=100){let r=null;return(...e)=>{null===r&&(r=setTimeout(()=>{t.apply(this,e),r=null},l))}}destroy(){this._handleWindowScrollThrottled&&window.removeEventListener("scroll",this._handleWindowScrollThrottled,!1),this._handleWindowResizeThrottled&&window.removeEventListener("resize",this._handleWindowResizeThrottled),this.headWrapperElement&&this._handleBodyWrapperHorizontalScrollThrottled&&this.headWrapperElement.removeEventListener("scroll",this._handleBodyWrapperHorizontalScrollThrottled,!1),this.bodyWrapperElement&&this._handleBodyWrapperHorizontalScrollThrottled&&this.bodyWrapperElement.removeEventListener("scroll",this._handleBodyWrapperHorizontalScrollThrottled,!1)}}});
